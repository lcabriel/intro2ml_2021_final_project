axis(side=4, at=pretty(range(Veneto_firstw$terapia_intensiva)))
mtext("terapia intensiva", side=4, line=3)
# estimate of the peak time
d <- 13
mov_av_delta_icu <- c()
d_half <- (d-1)/2
for(i in (1+d_half):(length(times)-d_half-1)){
mov_av_delta_icu[i] <- mean(delta_icu[(i-d_half):(i+d_half)])
}
plot(mov_av_delta_icu)
abline(h=0, lty="dashed")
abline(v=95, lty="dashed")
abline(v=90, lty="dashed", col="blue")
abline(v=100, lty="dashed", col="red")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ exp(-index_extr*0.01)*sin(2*pi*index_extr/189), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ exp(-0.01*x)*sin(2*pi*x/189))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ sin(2*pi*x/189))
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ sin(2*pi*index_extr/189), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ sin(2*pi*x/189))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ exp(-index_extr)*poly(index_extr,degree = 3), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ sin(2*pi*x/189))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ exp(-index_extr)*poly(index_extr,degree = 3), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ exp(-x)poly(x,3,raw=TRUE))
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ exp(-index_extr)*poly(index_extr,degree = 3), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ exp(-x)*poly(x,3,raw=TRUE))
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ exp(-index_extr*0.01)*poly(index_extr,degree = 3), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ exp(-x*0.01)*poly(x,3,raw=TRUE))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ exp(-index_extr*0.1)*poly(index_extr,degree = 3), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ exp(-x*0.1)*poly(x,3,raw=TRUE))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ exp(-index_extr*0.001)*poly(index_extr,degree = 3), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ exp(-x*0.001)*poly(x,3,raw=TRUE))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ poly(index_extr,degree = 3), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ poly(x,3,raw=TRUE))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ sin(index_extr*2*pi/188), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ poly(x,3,raw=TRUE))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ sin(index_extr*2*pi/188)+cos(index_extr*2*pi/188), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ sin(x*2*pi/188)+cos(x*2*pi/188))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ poly(sin(index_extr*2*pi/188),degree = 3), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ poly(sin(x*2*pi/188),degree=3,raw=TRUE))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ poly(sin(index_extr),degree = 3), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ poly(sin(x*2*pi/188),degree=3,raw=TRUE))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ poly(sin(index_extr),degree = 3), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ poly(sin(x),degree=3,raw=TRUE))
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ index_extr*sin(index_extr*2*pi/188), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ x*sin(x*2*pi/188))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ (1/index_extr)*sin(index_extr*2*pi/188), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ (1/x)*sin(x*2*pi/188))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ sin(index_extr*2*pi/188)/index_extr, data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ sin(x*2*pi/188)/x)
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ ((index_extr)^-1)*sin(index_extr*2*pi/188), data=delta_icu_extr_df)
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ inverse(index_extr)*sin(index_extr*2*pi/188), data=delta_icu_extr_df)
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ inverse(index_extr)*sin(index_extr*2*pi/188), data=delta_icu_extr_df)
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ index_extr*sin(index_extr*2*pi/188), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ sin(x*2*pi/188)/x)
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ sin(index_extr*2*pi/188)/index_extr, data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ sin(x*2*pi/188)/x)
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
times_extr <- seq(from=n_obs, to=n_obs+delta_t_wave,1) # delta-icu has on element less, so here we start from n_obs
b_0 <- fit_poly3_extr$coefficients[1]
b_1 <- fit_poly3_extr$coefficients[2]
b_2 <- fit_poly3_extr$coefficients[3]
b_3 <- fit_poly3_extr$coefficients[4]
extr_icu <- c()
for (i in 1:delta_t_wave) {
t <- n_obs+i-1
# extr_icu[i] <- b_0 + b_1*t + b_2*t^2 + b_3*t^3
extr_icu[i] <- b_1*t + b_2*t^2 + b_3*t^3
}
times_pred <- c(times, times_extr[2:delta_t_wave])
delta_icu_pred <- c(delta_icu, extr_icu)
pred <- data.frame(times_pred,delta_icu_pred)
ggplot(pred, aes(x=times_pred, y=delta_icu_pred)) + geom_point() + stat_smooth(method=lm, formula=y~poly(x,3,raw=TRUE))
fitted_delta_icu <- c()
for (i in 1:length(pred$times_pred)) {
t <- i-1
fitted_delta_icu[i] <- b_1*t + b_2*t^2 + b_3*t^3
}
qqnorm(fitted_delta_icu)
times_extr <- seq(from=n_obs, to=n_obs+delta_t_wave,1) # delta-icu has on element less, so here we start from n_obs
b_0 <- fit_poly3_extr$coefficients[1]
b_1 <- fit_poly3_extr$coefficients[2]
b_2 <- fit_poly3_extr$coefficients[3]
b_3 <- fit_poly3_extr$coefficients[4]
extr_icu <- c()
for (i in 1:delta_t_wave) {
t <- n_obs+i-1
# extr_icu[i] <- b_0 + b_1*t + b_2*t^2 + b_3*t^3
extr_icu[i] <- b_1*t + b_2*t^2 + b_3*t^3
}
times_pred <- c(times, times_extr[2:delta_t_wave])
delta_icu_pred <- c(delta_icu, extr_icu)
pred <- data.frame(times_pred,delta_icu_pred)
ggplot(pred, aes(x=times_pred, y=delta_icu_pred)) + geom_point() + stat_smooth(method=lm, formula=y~poly(x,3,raw=TRUE))
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ sin(index_extr*2*pi/188), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ sin(x*2*pi/188)/x)
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ sin(index_extr*2*pi/188), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ sin(x*2*pi/188))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ sin(index_extr*pi/94), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ sin(x*pi/94))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ sin(index_extr*pi/94), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ sin(x*pi/94))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ index_extr*sin(index_extr*pi/94), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ x*sin(x*pi/94))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ [index_extr*sin(index_extr*pi/94)], data=delta_icu_extr_df)
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ 1*index_extr*sin(index_extr*pi/94), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ 1*x*sin(x*pi/94))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ index_extr*sin(index_extr*pi/94), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ x*sin(x*pi/94))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ I(index_extr*sin(index_extr*pi/94)), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ I(x*sin(x*pi/94)))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ I(sin(index_extr*pi/94)/index_extr), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ I(sin(x*pi/94)/x))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ sin(index_extr*pi/94), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ sin(x*pi/94))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ poly(index_extr,degree=3), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ poly(x,3,raw=TRUE))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ poly(index_extr,degree=5), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ poly(x,5,raw=TRUE))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ poly(index_extr,degree=3), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ poly(x,3,raw=TRUE))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
times_extr <- seq(from=n_obs, to=n_obs+delta_t_wave,1) # delta-icu has on element less, so here we start from n_obs
b_0 <- fit_poly3_extr$coefficients[1]
b_1 <- fit_poly3_extr$coefficients[2]
b_2 <- fit_poly3_extr$coefficients[3]
b_3 <- fit_poly3_extr$coefficients[4]
extr_icu <- c()
for (i in 1:delta_t_wave) {
t <- n_obs+i-1
# extr_icu[i] <- b_0 + b_1*t + b_2*t^2 + b_3*t^3
extr_icu[i] <- b_1*t + b_2*t^2 + b_3*t^3
}
times_pred <- c(times, times_extr[2:delta_t_wave])
delta_icu_pred <- c(delta_icu, extr_icu)
pred <- data.frame(times_pred,delta_icu_pred)
ggplot(pred, aes(x=times_pred, y=delta_icu_pred)) + geom_point() + stat_smooth(method=lm, formula=y~poly(x,3,raw=TRUE))
fitted_delta_icu <- c()
for (i in 1:length(pred$times_pred)) {
t <- i-1
fitted_delta_icu[i] <- b_1*t + b_2*t^2 + b_3*t^3
}
qqnorm(fitted_delta_icu)
qqline(fitted_delta_icu)
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
times_extr <- seq(from=n_obs, to=n_obs+delta_t_wave,1) # delta-icu has on element less, so here we start from n_obs
b_0 <- fit_poly3_extr$coefficients[1]
b_1 <- fit_poly3_extr$coefficients[2]
b_2 <- fit_poly3_extr$coefficients[3]
b_3 <- fit_poly3_extr$coefficients[4]
extr_icu <- c()
for (i in 1:delta_t_wave) {
t <- n_obs+i-1
# extr_icu[i] <- b_0 + b_1*t + b_2*t^2 + b_3*t^3
extr_icu[i] <- b_1*t + b_2*t^2 + b_3*t^3
}
times_pred <- c(times, times_extr[2:delta_t_wave])
delta_icu_pred <- c(delta_icu, extr_icu)
pred <- data.frame(times_pred,delta_icu_pred)
ggplot(pred, aes(x=times_pred, y=delta_icu_pred)) + geom_point() + stat_smooth(method=lm, formula=y~poly(x,3,raw=TRUE))
fitted_delta_icu <- c()
for (i in 1:length(pred$times_pred)) {
t <- i-1
fitted_delta_icu[i] <- b_1*t + b_2*t^2 + b_3*t^3
}
qqnorm(fitted_delta_icu)
qqline(fitted_delta_icu)
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
t_end_wave = 95*2
delta_t_wave = t_end_wave - length(times)
delta_icu_extr <- c(delta_icu, 0)
delta_icu_extr_df <- data.frame(delta_icu_extr)
delta_icu_extr_df$index_extr <- c(1:length(delta_icu),length(delta_icu)+delta_t_wave)
fit_poly3_extr <- lm(delta_icu_extr~ poly(index_extr,degree=3), data=delta_icu_extr_df)
ggplot(delta_icu_extr_df, aes(x=index_extr, y=delta_icu_extr)) + geom_point() + stat_smooth(method=lm, formula=y~ poly(x,3,raw=TRUE))
summary(fit_poly3_extr)
plot(fitted(fit_poly3_extr), residuals(fit_poly3_extr))
abline(h=0, lty="dashed")
abline(v=0, lty="dashed")
gc()
setwd("C:/Users/loren/Documents/GitHub/intro2ml_2021_final_project/Data")
library(dplyr)
library(syuzhet)
library(tm)
library(wordcloud)
library(SnowballC)
# IMPORT RAW DATA ---------------------------------------------------------
dataset <- utils::read.csv("dataset_full.csv", header = TRUE, sep = ",")
#dataset <- dataset %>% dplyr::mutate(tweet = as.character(myCorpus$ind))
dataset <- dataset %>% dplyr::mutate(tweet = as.character(tweet))
# SENTIMENT EXTRACTION -----------------------------------------------------------
output <- data.frame(anger = numeric(),
anticipation = numeric(),
disgust = numeric(),
fear = numeric(),
joy = numeric(),
sadness = numeric(),
surprise = numeric(),
trust = numeric(),
negative = numeric(),
positive = numeric())
for (row in 1:nrow(dataset)) {
df <- dataset[row, "tweet"] %>%
syuzhet::get_sentences() %>% # sentiment by sentence
#syuzhet::get_tokens(pattern = "\\W") %>% # sentiment by word
syuzhet::get_nrc_sentiment(lang = "english", lowercase = TRUE) %>%
colSums() %>%
t() %>%
data.frame()
output <- rbind(output, df)
}
# OUTPUT ------------------------------------------------------------------
utils::write.csv(output, file = "sentiment_full.csv", row.names = FALSE)
